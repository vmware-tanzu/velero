Fix issue #8155, Merge Kopia upstream commits for critical issue fixes and performance improvements